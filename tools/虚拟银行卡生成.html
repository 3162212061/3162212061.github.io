<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é“¶è¡Œå¡å·¥å…· - è™šæ‹Ÿå¡ç”Ÿæˆå™¨</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
            padding: 30px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            backdrop-filter: blur(10px);
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .tabs {
            display: flex;
            margin-bottom: 20px;
            background: white;
            border-radius: 15px 15px 0 0;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }

        .tab {
            flex: 1;
            padding: 15px 20px;
            text-align: center;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            border-bottom: 3px solid transparent;
        }

        .tab.active {
            background: #667eea;
            color: white;
            border-bottom: 3px solid #fff;
        }

        .tab-content {
            display: none;
            background: white;
            border-radius: 0 0 15px 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }

        .tab-content.active {
            display: block;
        }

        .card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }

        .card h2 {
            color: #667eea;
            margin-bottom: 20px;
            font-size: 1.5em;
            border-bottom: 3px solid #667eea;
            padding-bottom: 10px;
        }

        .input-group {
            margin-bottom: 15px;
        }

        .input-group label {
            display: block;
            margin-bottom: 8px;
            color: #333;
            font-weight: 600;
        }

        .input-group input,
        .input-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
        }

        .input-group input:focus,
        .input-group select:focus {
            outline: none;
            border-color: #667eea;
        }

        .btn {
            width: 100%;
            padding: 12px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn:active {
            transform: translateY(0);
        }

        .result {
            margin-top: 20px;
            padding: 15px;
            background: #f5f5f5;
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }

        .result h3 {
            color: #667eea;
            margin-bottom: 10px;
        }

        .result-item {
            padding: 8px 0;
            border-bottom: 1px solid #e0e0e0;
        }

        .result-item:last-child {
            border-bottom: none;
        }

        .card-number {
            font-family: 'Courier New', monospace;
            font-size: 1.3em;
            font-weight: bold;
            color: #333;
            letter-spacing: 2px;
        }

        .valid {
            color: #4caf50;
            font-weight: bold;
        }

        .invalid {
            color: #f44336;
            font-weight: bold;
        }

        .warning {
            background: #fff3cd;
            border: 1px solid #ffc107;
            color: #856404;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 25px;
            font-size: 14px;
        }

        .warning strong {
            display: block;
            margin-bottom: 5px;
        }

        .card-preview {
            margin: 30px 0;
            text-align: center;
        }

        .bank-card-canvas {
            max-width: 100%;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            display: none;
        }

        .bank-card-canvas.show {
            display: inline-block;
        }

        .button-group {
            display: flex;
            gap: 15px;
            margin-top: 30px;
        }

        .button-group button {
            flex: 1;
            padding: 15px 30px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-generate {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-generate:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(102, 126, 234, 0.4);
        }

        .btn-download {
            background: #28a745;
            color: white;
            display: none;
        }

        .btn-download.show {
            display: block;
        }

        .btn-download:hover {
            background: #218838;
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(40, 167, 69, 0.4);
        }

        .bank-info {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-top: 10px;
            display: none;
        }

        .bank-info.show {
            display: block;
        }

        .bank-info p {
            color: #666;
            font-size: 14px;
            margin: 5px 0;
        }

        .bank-info strong {
            color: #333;
        }

        .bank-info.warning {
            background: #fff3cd;
            border: 1px solid #ffc107;
        }

        .bank-info.warning p {
            color: #856404;
        }

        .bank-selector {
            display: none;
            margin-top: 15px;
        }

        .bank-selector.show {
            display: block;
        }

        .suffix-input-container {
            display: flex;
            align-items: center;
        }

        .suffix-input-container input {
            flex: 1;
        }

        .suffix-input-container .clear-btn {
            margin-left: 10px;
            padding: 8px 12px;
            background: #f0f0f0;
            border: 1px solid #ddd;
            border-radius: 5px;
            cursor: pointer;
        }

        .suffix-input-container .clear-btn:hover {
            background: #e0e0e0;
        }

        .suffix-note {
            font-size: 0.85em;
            color: #666;
            margin-top: 5px;
        }

        .batch-result {
            max-height: 400px;
            overflow-y: auto;
            margin-top: 15px;
        }

        .batch-item {
            padding: 10px;
            background: #f9f9f9;
            border-radius: 5px;
            margin-bottom: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .copy-btn {
            padding: 5px 10px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 12px;
        }

        .copy-btn:hover {
            background: #5568d3;
        }

        .tooltip {
            position: relative;
            display: inline-block;
            cursor: help;
            color: #667eea;
            margin-left: 5px;
        }

        .tooltip:hover::after {
            content: attr(data-tooltip);
            position: absolute;
            bottom: 125%;
            left: 50%;
            transform: translateX(-50%);
            background: #333;
            color: white;
            padding: 8px 12px;
            border-radius: 5px;
            white-space: nowrap;
            font-size: 12px;
            z-index: 1000;
        }

        .card-preview-container {
            margin-top: 20px;
            text-align: center;
        }

        .card-holder-input {
            margin-top: 15px;
        }

        .form-row {
            display: flex;
            gap: 15px;
        }

        .form-row .input-group {
            flex: 1;
        }

        .feature-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .feature-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            display: flex;
            flex-direction: column;
            height: 100%;
        }

        .feature-card h3 {
            color: #667eea;
            margin-bottom: 15px;
            font-size: 1.3em;
            display: flex;
            align-items: center;
        }

        .feature-card h3 i {
            margin-right: 10px;
            font-size: 1.5em;
        }

        .feature-card p {
            color: #666;
            margin-bottom: 20px;
            flex-grow: 1;
        }

        .feature-card .btn {
            margin-top: auto;
        }

        .card-image {
            width: 100%;
            border-radius: 10px;
            margin-bottom: 15px;
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 1.8em;
            }

            .button-group {
                flex-direction: column;
            }

            .form-row {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- å¤´éƒ¨ -->
        <div class="header">
            <h1>ğŸ¦ è™šæ‹Ÿé“¶è¡Œå¡ç”Ÿæˆå™¨</h1>
            <p>å¿«é€Ÿç”Ÿæˆé“¶è¡Œå¡å·ä¸ç²¾ç¾å¡ç‰‡è®¾è®¡</p>
        </div>

        <!-- é€‰é¡¹å¡ -->
        <div class="tabs">
            <div class="tab active" data-tab="generate">ç”Ÿæˆé“¶è¡Œå¡</div>
            <div class="tab" data-tab="batch">æ‰¹é‡ç”Ÿæˆ</div>
            <div class="tab" data-tab="custom">è‡ªå®šä¹‰è®¾è®¡</div>
        </div>

        <!-- ç”Ÿæˆé“¶è¡Œå¡é€‰é¡¹å¡å†…å®¹ -->
        <div class="tab-content active" id="generate-tab">
            <div class="feature-grid">
                <div class="feature-card">
                    <h3><i>ğŸ”¢</i> ç”Ÿæˆé“¶è¡Œå¡å·</h3>
                    <p>æ ¹æ®é“¶è¡ŒBINç å’Œè‡ªå®šä¹‰å‚æ•°ç”Ÿæˆç¬¦åˆLUHNç®—æ³•çš„é“¶è¡Œå¡å·</p>
                    
                    <div class="input-group">
                        <label>é€‰æ‹©é“¶è¡Œï¼š</label>
                        <select id="bankSelect" onchange="updatePrefix()">
                            <option value="622202">ä¸­å›½å·¥å•†é“¶è¡Œ (622202)</option>
                            <option value="622848">ä¸­å›½å†œä¸šé“¶è¡Œ (622848)</option>
                            <option value="622700">ä¸­å›½å»ºè®¾é“¶è¡Œ (622700)</option>
                            <option value="622588">ä¸­å›½é“¶è¡Œ (622588)</option>
                            <option value="621483">æ‹›å•†é“¶è¡Œ (621483)</option>
                            <option value="622260">äº¤é€šé“¶è¡Œ (622260)</option>
                            <option value="621098">é‚®æ”¿å‚¨è“„é“¶è¡Œ (621098)</option>
                            <option value="custom">è‡ªå®šä¹‰å‰ç¼€</option>
                        </select>
                    </div>
                    
                    <div class="form-row">
                        <div class="input-group">
                            <label>å¡å·å‰ç¼€ï¼š</label>
                            <input type="text" id="prefixInput" value="622202" maxlength="10">
                        </div>
                        <div class="input-group">
                            <label>å¡å·é•¿åº¦ï¼š</label>
                            <input type="number" id="lengthInput" value="16" min="13" max="19">
                        </div>
                    </div>
                    
                    <!-- æ·»åŠ ï¼šè‡ªå®šä¹‰å°¾å·è¾“å…¥ -->
                    <div class="input-group">
                        <label>è‡ªå®šä¹‰å°¾å·ï¼ˆåŒ…å«æ ¡éªŒä½ï¼‰ï¼š<span class="tooltip" data-tooltip="è¾“å…¥1-5ä½æ•°å­—ï¼Œç”Ÿæˆçš„å¡å·å°†ä»¥è¿™äº›æ•°å­—ç»“å°¾ï¼Œæœ€åä¸€ä½ä¸ºæ ¡éªŒä½">â“˜</span></label>
                        <div class="suffix-input-container">
                            <input type="text" id="suffixInput" placeholder="ä¾‹å¦‚ï¼š01" maxlength="5">
                            <button class="clear-btn" onclick="clearSuffix()">æ¸…é™¤</button>
                        </div>
                        <div class="suffix-note">æ³¨æ„ï¼šå°¾å·æœ€åä¸€ä½æ˜¯æ ¡éªŒä½ï¼Œç³»ç»Ÿå°†è°ƒæ•´å‰é¢çš„æ•°å­—ä»¥ç¡®ä¿ç¬¦åˆLUHNç®—æ³•</div>
                    </div>
                    
                    <div class="input-group">
                        <label>æŒå¡äººå§“åï¼ˆå¯é€‰ï¼‰ï¼š</label>
                        <input type="text" id="cardHolderInput" placeholder="ä¾‹å¦‚ï¼šå¼ ä¸‰" maxlength="20">
                    </div>
                    
                    <button class="btn" onclick="generateCard()">ç”Ÿæˆé“¶è¡Œå¡</button>
                </div>
                
                <div class="feature-card">
                    <h3><i>ğŸ–¼ï¸</i> é“¶è¡Œå¡é¢„è§ˆ</h3>
                    <p>å®æ—¶é¢„è§ˆç”Ÿæˆçš„é“¶è¡Œå¡è®¾è®¡æ•ˆæœ</p>
                    
                    <div class="card-preview-container">
                        <canvas id="generatedCardCanvas" class="bank-card-canvas" width="800" height="500"></canvas>
                        <div class="button-group">
                            <button class="btn-download" id="downloadGeneratedCard">ä¸‹è½½é“¶è¡Œå¡å›¾ç‰‡</button>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="card">
                <h2>ğŸ“‹ ç”Ÿæˆç»“æœ</h2>
                <div id="generateResult" class="result" style="display:none;">
                    <h3>ç”Ÿæˆç»“æœï¼š</h3>
                    <div id="generateResultContent"></div>
                </div>
                <p style="text-align: center; color: #666; margin-top: 20px;">ç”Ÿæˆçš„å¡å·ä»…ç”¨äºæµ‹è¯•ç›®çš„ï¼Œä¸å¯ç”¨äºå®é™…äº¤æ˜“</p>
            </div>
        </div>

        <!-- æ‰¹é‡ç”Ÿæˆé€‰é¡¹å¡å†…å®¹ -->
        <div class="tab-content" id="batch-tab">
            <div class="warning">
                <strong>âš ï¸ é‡è¦æç¤º</strong>
                æ­¤å·¥å…·ç”Ÿæˆçš„é“¶è¡Œå¡ä»…ç”¨äºç•Œé¢æµ‹è¯•ï¼Œä¸å¯ç”¨äºä»»ä½•å®é™…äº¤æ˜“æˆ–éæ³•ç”¨é€”ã€‚
            </div>

            <div class="card">
                <h2>ğŸ“¦ æ‰¹é‡ç”Ÿæˆé“¶è¡Œå¡å·</h2>
                <div class="form-row">
                    <div class="input-group">
                        <label>å¡å·å‰ç¼€ï¼š</label>
                        <input type="text" id="batchPrefix" value="622202" maxlength="10">
                    </div>
                    <div class="input-group">
                        <label>å¡å·é•¿åº¦ï¼š</label>
                        <input type="number" id="batchLength" value="16" min="13" max="19">
                    </div>
                    <div class="input-group">
                        <label>ç”Ÿæˆæ•°é‡ï¼š</label>
                        <input type="number" id="batchCount" value="10" min="1" max="100">
                    </div>
                </div>
                
                <!-- æ·»åŠ ï¼šæ‰¹é‡ç”Ÿæˆçš„è‡ªå®šä¹‰å°¾å·è¾“å…¥ -->
                <div class="input-group">
                    <label>è‡ªå®šä¹‰å°¾å·ï¼ˆåŒ…å«æ ¡éªŒä½ï¼‰ï¼š<span class="tooltip" data-tooltip="è¾“å…¥1-5ä½æ•°å­—ï¼Œç”Ÿæˆçš„å¡å·å°†ä»¥è¿™äº›æ•°å­—ç»“å°¾ï¼Œæœ€åä¸€ä½ä¸ºæ ¡éªŒä½">â“˜</span></label>
                    <div class="suffix-input-container">
                        <input type="text" id="batchSuffix" placeholder="ä¾‹å¦‚ï¼š01" maxlength="5">
                        <button class="clear-btn" onclick="clearBatchSuffix()">æ¸…é™¤</button>
                    </div>
                    <div class="suffix-note">æ³¨æ„ï¼šå°¾å·æœ€åä¸€ä½æ˜¯æ ¡éªŒä½ï¼Œç³»ç»Ÿå°†è°ƒæ•´å‰é¢çš„æ•°å­—ä»¥ç¡®ä¿ç¬¦åˆLUHNç®—æ³•</div>
                </div>
                
                <button class="btn" onclick="batchGenerate()">æ‰¹é‡ç”Ÿæˆ</button>
                <div id="batchResult" class="batch-result" style="display:none;"></div>
            </div>
        </div>

        <!-- è‡ªå®šä¹‰è®¾è®¡é€‰é¡¹å¡å†…å®¹ -->
        <div class="tab-content" id="custom-tab">
            <div class="warning">
                <strong>âš ï¸ é‡è¦æç¤º</strong>
                æ­¤å·¥å…·ç”Ÿæˆçš„é“¶è¡Œå¡ä»…ç”¨äºç•Œé¢æµ‹è¯•ï¼Œä¸å¯ç”¨äºä»»ä½•å®é™…äº¤æ˜“æˆ–éæ³•ç”¨é€”ã€‚
            </div>

            <div class="card">
                <h2>ğŸ¨ è‡ªå®šä¹‰é“¶è¡Œå¡è®¾è®¡</h2>
                <p class="subtitle">æ‰‹åŠ¨è¾“å…¥å¡å·å¹¶è‡ªå®šä¹‰é“¶è¡Œå¡å¤–è§‚</p>

                <div class="input-group">
                    <label for="cardNumber">é“¶è¡Œå¡å·</label>
                    <input type="text" id="cardNumber" placeholder="è¯·è¾“å…¥16-19ä½é“¶è¡Œå¡å·" maxlength="19">
                    <div id="bankInfo" class="bank-info"></div>
                    
                    <!-- æ‰‹åŠ¨é€‰æ‹©é“¶è¡Œ -->
                    <div id="bankSelector" class="bank-selector">
                        <label for="manualBank">æ‰‹åŠ¨é€‰æ‹©é“¶è¡Œï¼š</label>
                        <select id="manualBank">
                            <option value="">-- è¯·é€‰æ‹©é“¶è¡Œ --</option>
                            <option value="ICBC">å·¥å•†é“¶è¡Œ</option>
                            <option value="ABC">å†œä¸šé“¶è¡Œ</option>
                            <option value="CCB">å»ºè®¾é“¶è¡Œ</option>
                            <option value="BOC">ä¸­å›½é“¶è¡Œ</option>
                            <option value="PSBC">é‚®å‚¨é“¶è¡Œ</option>
                            <option value="CMB">æ‹›å•†é“¶è¡Œ</option>
                            <option value="BCM">äº¤é€šé“¶è¡Œ</option>
                            <option value="CMBC">æ°‘ç”Ÿé“¶è¡Œ</option>
                            <option value="CITIC">ä¸­ä¿¡é“¶è¡Œ</option>
                            <option value="CEB">å…‰å¤§é“¶è¡Œ</option>
                            <option value="CIB">å…´ä¸šé“¶è¡Œ</option>
                            <option value="CGB">å¹¿å‘é“¶è¡Œ</option>
                            <option value="PAB">å¹³å®‰é“¶è¡Œ</option>
                            <option value="SPDB">æµ¦å‘é“¶è¡Œ</option>
                            <option value="HXB">åå¤é“¶è¡Œ</option>
                        </select>
                    </div>
                </div>

                <div class="input-group">
                    <label for="cardHolder">æŒå¡äººå§“åï¼ˆå¯é€‰ï¼‰</label>
                    <input type="text" id="cardHolder" placeholder="è¯·è¾“å…¥æŒå¡äººå§“å">
                </div>

                <div class="card-preview">
                    <canvas id="bankCard" width="800" height="500"></canvas>
                </div>

                <div class="button-group">
                    <button class="btn-generate" id="generateBtn">ç”Ÿæˆé“¶è¡Œå¡</button>
                    <button class="btn-download" id="downloadBtn">ä¸‹è½½é“¶è¡Œå¡</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // é€‰é¡¹å¡åˆ‡æ¢åŠŸèƒ½
        document.querySelectorAll('.tab').forEach(tab => {
            tab.addEventListener('click', function() {
                // ç§»é™¤æ‰€æœ‰æ´»åŠ¨çŠ¶æ€
                document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                
                // æ·»åŠ å½“å‰æ´»åŠ¨çŠ¶æ€
                this.classList.add('active');
                document.getElementById(this.dataset.tab + '-tab').classList.add('active');
            });
        });

        // ==================== LUHNç®—æ³•éƒ¨åˆ† ====================

        // LUHNç®—æ³•æ ¸å¿ƒå‡½æ•°
        function calculateLuhnChecksum(cardNumber) {
            const cardStr = cardNumber.toString().replace(/\s/g, '');
            let doubledSum = 0;
            let undoubledSum = 0;

            // ä»å³å¾€å·¦éå†
            for (let i = 0; i < cardStr.length; i++) {
                const digit = parseInt(cardStr[cardStr.length - 1 - i]);
                
                if (i % 2 === 0) {
                    // å¥‡æ•°ä½ï¼ˆä»å³è¾¹ç¬¬1ä½å¼€å§‹ï¼‰ä¹˜ä»¥2
                    const doubled = digit * 2;
                    doubledSum += Math.floor(doubled / 10) + (doubled % 10);
                } else {
                    // å¶æ•°ä½ä¿æŒä¸å˜
                    undoubledSum += digit;
                }
            }

            const totalSum = doubledSum + undoubledSum;
            const checksum = (10 - (totalSum % 10)) % 10;
            
            return {
                checksum: checksum,
                doubledSum: doubledSum,
                undoubledSum: undoubledSum,
                totalSum: totalSum,
                cardBody: cardStr
            };
        }

        // éªŒè¯é“¶è¡Œå¡å·
        function verifyLuhn(cardNumber) {
            const cardStr = cardNumber.toString().replace(/\s/g, '');
            if (cardStr.length < 13 || cardStr.length > 19) {
                return false;
            }

            const cardBody = cardStr.slice(0, -1);
            const checkDigit = parseInt(cardStr.slice(-1));
            const result = calculateLuhnChecksum(cardBody);
            
            return result.checksum === checkDigit;
        }

        // æ ¼å¼åŒ–é“¶è¡Œå¡å·
        function formatCardNumber(cardNumber) {
            const cardStr = cardNumber.toString().replace(/\s/g, '');
            return cardStr.replace(/(\d{4})(?=\d)/g, '$1 ');
        }

        // ç”Ÿæˆéšæœºé“¶è¡Œå¡å·ï¼ˆæ”¯æŒè‡ªå®šä¹‰å°¾å·ï¼ŒåŒ…å«æ ¡éªŒä½ï¼‰
        function generateRandomCard(prefix, length, suffix = '') {
            // è®¡ç®—éœ€è¦éšæœºç”Ÿæˆçš„ä½æ•°
            const totalLength = length;
            const prefixLength = prefix.length;
            const suffixLength = suffix.length;
            
            // å¦‚æœæŒ‡å®šäº†å°¾å·ï¼Œåˆ™å°¾å·çš„æœ€åä¸€ä½å¿…é¡»æ˜¯æ ¡éªŒä½
            if (suffix) {
                // è®¡ç®—ä¸­é—´éƒ¨åˆ†çš„é•¿åº¦
                const middleLength = totalLength - prefixLength - suffixLength;
                
                if (middleLength < 0) {
                    alert('å¡å·é•¿åº¦ä¸è¶³ï¼Œè¯·å¢åŠ å¡å·é•¿åº¦æˆ–å‡å°‘å‰ç¼€/å°¾å·é•¿åº¦ï¼');
                    return null;
                }
                
                // ç”Ÿæˆä¸­é—´éƒ¨åˆ†
                let middlePart = '';
                for (let i = 0; i < middleLength; i++) {
                    middlePart += Math.floor(Math.random() * 10);
                }
                
                // æ„é€ å®Œæ•´å¡å·ï¼ˆä¸å«æ ¡éªŒä½ï¼‰
                const cardBody = prefix + middlePart + suffix.slice(0, -1);
                
                // è®¡ç®—æ ¡éªŒä½
                const result = calculateLuhnChecksum(cardBody);
                
                // å¦‚æœè®¡ç®—å‡ºçš„æ ¡éªŒä½ä¸å°¾å·æœ€åä¸€ä½ä¸åŒ¹é…ï¼Œéœ€è¦è°ƒæ•´ä¸­é—´éƒ¨åˆ†
                if (result.checksum.toString() !== suffix.slice(-1)) {
                    // å°è¯•è°ƒæ•´ä¸­é—´éƒ¨åˆ†æ¥åŒ¹é…æ ¡éªŒä½
                    return adjustCardForSuffix(prefix, length, suffix);
                }
                
                return cardBody + result.checksum;
            } else {
                // åŸæ¥çš„é€»è¾‘ï¼šç”Ÿæˆéšæœºå¡å·
                const neededLength = length - prefix.length - 1;
                let cardBody = prefix;
                
                for (let i = 0; i < neededLength; i++) {
                    cardBody += Math.floor(Math.random() * 10);
                }
                
                const result = calculateLuhnChecksum(cardBody);
                return cardBody + result.checksum;
            }
        }

        // è°ƒæ•´å¡å·ä»¥åŒ¹é…æŒ‡å®šçš„å°¾å·ï¼ˆåŒ…å«æ ¡éªŒä½ï¼‰
        function adjustCardForSuffix(prefix, length, suffix) {
            const maxAttempts = 10000; // æœ€å¤§å°è¯•æ¬¡æ•°
            const totalLength = length;
            const prefixLength = prefix.length;
            const suffixLength = suffix.length;
            const middleLength = totalLength - prefixLength - suffixLength;
            
            if (middleLength <= 0) {
                alert('æ— æ³•ç”Ÿæˆç¬¦åˆè¦æ±‚çš„å¡å·ï¼Œè¯·å¢åŠ å¡å·é•¿åº¦æˆ–å‡å°‘å‰ç¼€/å°¾å·é•¿åº¦ï¼');
                return null;
            }
            
            // å°è¯•ç”ŸæˆåŒ¹é…çš„å¡å·
            for (let attempt = 0; attempt < maxAttempts; attempt++) {
                // ç”Ÿæˆä¸­é—´éƒ¨åˆ†
                let middlePart = '';
                for (let i = 0; i < middleLength; i++) {
                    middlePart += Math.floor(Math.random() * 10);
                }
                
                // æ„é€ å®Œæ•´å¡å·ï¼ˆä¸å«æ ¡éªŒä½ï¼‰
                const cardBody = prefix + middlePart + suffix.slice(0, -1);
                
                // è®¡ç®—æ ¡éªŒä½
                const result = calculateLuhnChecksum(cardBody);
                
                // æ£€æŸ¥æ ¡éªŒä½æ˜¯å¦åŒ¹é…
                if (result.checksum.toString() === suffix.slice(-1)) {
                    return cardBody + result.checksum;
                }
            }
            
            alert('æ— æ³•ç”Ÿæˆç¬¦åˆè¦æ±‚çš„å¡å·ï¼Œè¯·å°è¯•æ›´æ”¹å‰ç¼€ã€å°¾å·æˆ–é•¿åº¦ï¼');
            return null;
        }

        // è¯†åˆ«é“¶è¡Œä¿¡æ¯
        function identifyBank(cardNumber) {
            const bankDatabase = {
                '622202': { name: 'ä¸­å›½å·¥å•†é“¶è¡Œ', type: 'å€Ÿè®°å¡' },
                '622200': { name: 'ä¸­å›½å·¥å•†é“¶è¡Œ', type: 'å€Ÿè®°å¡' },
                '955880': { name: 'ä¸­å›½å·¥å•†é“¶è¡Œ', type: 'ä¿¡ç”¨å¡' },
                '622848': { name: 'ä¸­å›½å†œä¸šé“¶è¡Œ', type: 'å€Ÿè®°å¡' },
                '622845': { name: 'ä¸­å›½å†œä¸šé“¶è¡Œ', type: 'å€Ÿè®°å¡' },
                '622700': { name: 'ä¸­å›½å»ºè®¾é“¶è¡Œ', type: 'å€Ÿè®°å¡' },
                '436742': { name: 'ä¸­å›½å»ºè®¾é“¶è¡Œ', type: 'ä¿¡ç”¨å¡' },
                '622588': { name: 'ä¸­å›½é“¶è¡Œ', type: 'å€Ÿè®°å¡' },
                '621660': { name: 'ä¸­å›½é“¶è¡Œ', type: 'å€Ÿè®°å¡' },
                '621483': { name: 'æ‹›å•†é“¶è¡Œ', type: 'å€Ÿè®°å¡' },
                '621486': { name: 'æ‹›å•†é“¶è¡Œ', type: 'å€Ÿè®°å¡' },
                '622260': { name: 'äº¤é€šé“¶è¡Œ', type: 'å€Ÿè®°å¡' },
                '621098': { name: 'é‚®æ”¿å‚¨è“„é“¶è¡Œ', type: 'å€Ÿè®°å¡' },
                '622150': { name: 'é‚®æ”¿å‚¨è“„é“¶è¡Œ', type: 'å€Ÿè®°å¡' }
            };

            for (let bin in bankDatabase) {
                if (cardNumber.startsWith(bin)) {
                    return bankDatabase[bin];
                }
            }
            
            return { name: 'æœªçŸ¥é“¶è¡Œ', type: 'æœªçŸ¥ç±»å‹' };
        }

        // ç”Ÿæˆé“¶è¡Œå¡å·åŠŸèƒ½ï¼ˆæ”¯æŒè‡ªå®šä¹‰å°¾å·ï¼ŒåŒ…å«æ ¡éªŒä½ï¼‰
        function generateCard() {
            const prefix = document.getElementById('prefixInput').value.replace(/\s/g, '');
            const length = parseInt(document.getElementById('lengthInput').value);
            const suffix = document.getElementById('suffixInput').value.replace(/\s/g, '');
            const cardHolder = document.getElementById('cardHolderInput').value.trim() || 'æŒå¡äººå§“å';
            const resultDiv = document.getElementById('generateResult');
            const contentDiv = document.getElementById('generateResultContent');
            const canvas = document.getElementById('generatedCardCanvas');
            const downloadBtn = document.getElementById('downloadGeneratedCard');

            if (!prefix || !/^\d+$/.test(prefix)) {
                alert('è¯·è¾“å…¥æœ‰æ•ˆçš„å‰ç¼€æ•°å­—ï¼');
                return;
            }

            if (length < 13 || length > 19) {
                alert('å¡å·é•¿åº¦åº”åœ¨13-19ä½ä¹‹é—´ï¼');
                return;
            }

            if (prefix.length >= length) {
                alert('å‰ç¼€é•¿åº¦ä¸èƒ½å¤§äºç­‰äºæ€»é•¿åº¦ï¼');
                return;
            }

            if (suffix && !/^\d+$/.test(suffix)) {
                alert('è‡ªå®šä¹‰å°¾å·å¿…é¡»ä¸ºæ•°å­—ï¼');
                return;
            }

            const cardNumber = generateRandomCard(prefix, length, suffix);
            if (cardNumber === null) {
                return;
            }

            const bankInfo = identifyBank(cardNumber);
            
            // è·å–é“¶è¡Œè¯¦ç»†ä¿¡æ¯ç”¨äºç”Ÿæˆå¡ç‰‡
            const bankDetails = getBankDetails(cardNumber);
            
            // ç»˜åˆ¶é“¶è¡Œå¡
            drawBankCard(canvas, bankDetails, cardNumber, cardHolder, false);
            
            // æ˜¾ç¤ºç”»å¸ƒå’Œä¸‹è½½æŒ‰é’®
            canvas.classList.add('show');
            downloadBtn.classList.add('show');
            
            // è®¾ç½®ä¸‹è½½æŒ‰é’®äº‹ä»¶
            downloadBtn.onclick = function() {
                const link = document.createElement('a');
                link.download = `é“¶è¡Œå¡_${cardNumber}.png`;
                link.href = canvas.toDataURL('image/png');
                link.click();
            };

            contentDiv.innerHTML = `
                <div class="result-item">
                    <strong>ç”Ÿæˆçš„å¡å·ï¼š</strong><span class="card-number">${formatCardNumber(cardNumber)}</span>
                </div>
                <div class="result-item">
                    <strong>é“¶è¡Œä¿¡æ¯ï¼š</strong>${bankInfo.name} - ${bankInfo.type}
                </div>
                <div class="result-item">
                    <strong>å¡å·é•¿åº¦ï¼š</strong>${cardNumber.length}ä½
                </div>
                ${suffix ? `<div class="result-item">
                    <strong>è‡ªå®šä¹‰å°¾å·ï¼š</strong>${suffix}ï¼ˆæœ€åä¸€ä½æ˜¯æ ¡éªŒä½ï¼‰
                </div>` : ''}
                <div class="result-item">
                    <strong>éªŒè¯çŠ¶æ€ï¼š</strong><span class="valid">âœ“ å·²é€šè¿‡LUHNéªŒè¯</span>
                </div>
                <button class="btn" onclick="copyToClipboard('${cardNumber}')" style="margin-top: 10px;">å¤åˆ¶å¡å·</button>
            `;

            resultDiv.style.display = 'block';
        }

        // æ‰¹é‡ç”ŸæˆåŠŸèƒ½ï¼ˆæ”¯æŒè‡ªå®šä¹‰å°¾å·ï¼ŒåŒ…å«æ ¡éªŒä½ï¼‰
        function batchGenerate() {
            const prefix = document.getElementById('batchPrefix').value.replace(/\s/g, '');
            const length = parseInt(document.getElementById('batchLength').value);
            const count = parseInt(document.getElementById('batchCount').value);
            const suffix = document.getElementById('batchSuffix').value.replace(/\s/g, '');
            const resultDiv = document.getElementById('batchResult');

            if (!prefix || !/^\d+$/.test(prefix)) {
                alert('è¯·è¾“å…¥æœ‰æ•ˆçš„å‰ç¼€æ•°å­—ï¼');
                return;
            }

            if (length < 13 || length > 19) {
                alert('å¡å·é•¿åº¦åº”åœ¨13-19ä½ä¹‹é—´ï¼');
                return;
            }

            if (count < 1 || count > 100) {
                alert('ç”Ÿæˆæ•°é‡åº”åœ¨1-100ä¹‹é—´ï¼');
                return;
            }

            if (prefix.length >= length) {
                alert('å‰ç¼€é•¿åº¦ä¸èƒ½å¤§äºç­‰äºæ€»é•¿åº¦ï¼');
                return;
            }

            if (suffix && !/^\d+$/.test(suffix)) {
                alert('è‡ªå®šä¹‰å°¾å·å¿…é¡»ä¸ºæ•°å­—ï¼');
                return;
            }

            let html = '<h3>ç”Ÿæˆçš„é“¶è¡Œå¡å·ï¼š</h3>';
            const cards = [];

            for (let i = 0; i < count; i++) {
                const cardNumber = generateRandomCard(prefix, length, suffix);
                if (cardNumber === null) {
                    return;
                }
                cards.push(cardNumber);
                html += `
                    <div class="batch-item">
                        <span class="card-number">${formatCardNumber(cardNumber)}</span>
                        <button class="copy-btn" onclick="copyToClipboard('${cardNumber}')">å¤åˆ¶</button>
                    </div>
                `;
            }

            html += `<button class="btn" onclick="copyAllCards(${JSON.stringify(cards).replace(/"/g, '&quot;')})" style="margin-top: 15px;">å¤åˆ¶å…¨éƒ¨</button>`;

            resultDiv.innerHTML = html;
            resultDiv.style.display = 'block';
        }

        // æ›´æ–°å‰ç¼€
        function updatePrefix() {
            const select = document.getElementById('bankSelect');
            const prefixInput = document.getElementById('prefixInput');
            
            if (select.value !== 'custom') {
                prefixInput.value = select.value;
                prefixInput.readOnly = true;
            } else {
                prefixInput.readOnly = false;
                prefixInput.focus();
            }
        }

        // å¤åˆ¶åˆ°å‰ªè´´æ¿
        function copyToClipboard(text) {
            const textarea = document.createElement('textarea');
            textarea.value = text;
            document.body.appendChild(textarea);
            textarea.select();
            document.execCommand('copy');
            document.body.removeChild(textarea);
            alert('å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼š' + formatCardNumber(text));
        }

        // å¤åˆ¶æ‰€æœ‰å¡å·
        function copyAllCards(cards) {
            const text = cards.join('\n');
            const textarea = document.createElement('textarea');
            textarea.value = text;
            document.body.appendChild(textarea);
            textarea.select();
            document.execCommand('copy');
            document.body.removeChild(textarea);
            alert(`å·²å¤åˆ¶${cards.length}ä¸ªå¡å·åˆ°å‰ªè´´æ¿ï¼`);
        }

        // æ¸…é™¤è‡ªå®šä¹‰å°¾å·
        function clearSuffix() {
            document.getElementById('suffixInput').value = '';
        }

        // æ¸…é™¤æ‰¹é‡ç”Ÿæˆçš„è‡ªå®šä¹‰å°¾å·
        function clearBatchSuffix() {
            document.getElementById('batchSuffix').value = '';
        }

        // ==================== è™šæ‹Ÿé“¶è¡Œå¡ç”Ÿæˆéƒ¨åˆ† ====================

        // é“¶è¡Œå¡BINç æ•°æ®åº“ï¼ˆå‰6ä½ï¼‰
        const bankDatabase = {
            '622202': { name: 'å·¥å•†é“¶è¡Œ', color: '#C8161D', logo: 'ICBC' },
            '622848': { name: 'å†œä¸šé“¶è¡Œ', color: '#00875A', logo: 'ABC' },
            '622700': { name: 'å»ºè®¾é“¶è¡Œ', color: '#003E7E', logo: 'CCB' },
            '621700': { name: 'å»ºè®¾é“¶è¡Œ', color: '#003E7E', logo: 'CCB' },
            '622280': { name: 'é‚®å‚¨é“¶è¡Œ', color: '#00873E', logo: 'PSBC' },
            '621096': { name: 'æ‹›å•†é“¶è¡Œ', color: '#D32F2F', logo: 'CMB' },
            '622588': { name: 'æ‹›å•†é“¶è¡Œ', color: '#D32F2F', logo: 'CMB' },
            '621286': { name: 'æ‹›å•†é“¶è¡Œ', color: '#D32F2F', logo: 'CMB' },
            '622609': { name: 'ä¸­å›½é“¶è¡Œ', color: '#B8292F', logo: 'BOC' },
            '621660': { name: 'ä¸­å›½é“¶è¡Œ', color: '#B8292F', logo: 'BOC' },
            '622208': { name: 'äº¤é€šé“¶è¡Œ', color: '#003366', logo: 'BCM' },
            '621002': { name: 'äº¤é€šé“¶è¡Œ', color: '#003366', logo: 'BCM' },
            '622600': { name: 'æ°‘ç”Ÿé“¶è¡Œ', color: '#006B3F', logo: 'CMBC' },
            '621691': { name: 'æ°‘ç”Ÿé“¶è¡Œ', color: '#006B3F', logo: 'CMBC' },
            '622622': { name: 'ä¸­ä¿¡é“¶è¡Œ', color: '#D4282D', logo: 'CITIC' },
            '622690': { name: 'å…‰å¤§é“¶è¡Œ', color: '#6F2D91', logo: 'CEB' },
            '622650': { name: 'å…´ä¸šé“¶è¡Œ', color: '#004EA2', logo: 'CIB' },
            '622656': { name: 'å¹¿å‘é“¶è¡Œ', color: '#C8161D', logo: 'CGB' },
            '621352': { name: 'å¹³å®‰é“¶è¡Œ', color: '#FF6600', logo: 'PAB' },
            '622155': { name: 'æµ¦å‘é“¶è¡Œ', color: '#0066B3', logo: 'SPDB' },
            '622521': { name: 'åå¤é“¶è¡Œ', color: '#D32F2F', logo: 'HXB' },
        };

        // é“¶è¡Œä»£ç æ˜ å°„è¡¨
        const bankCodeMap = {
            'ICBC': { name: 'å·¥å•†é“¶è¡Œ', color: '#C8161D', logo: 'ICBC' },
            'ABC': { name: 'å†œä¸šé“¶è¡Œ', color: '#00875A', logo: 'ABC' },
            'CCB': { name: 'å»ºè®¾é“¶è¡Œ', color: '#003E7E', logo: 'CCB' },
            'BOC': { name: 'ä¸­å›½é“¶è¡Œ', color: '#B8292F', logo: 'BOC' },
            'PSBC': { name: 'é‚®å‚¨é“¶è¡Œ', color: '#00873E', logo: 'PSBC' },
            'CMB': { name: 'æ‹›å•†é“¶è¡Œ', color: '#D32F2F', logo: 'CMB' },
            'BCM': { name: 'äº¤é€šé“¶è¡Œ', color: '#003366', logo: 'BCM' },
            'CMBC': { name: 'æ°‘ç”Ÿé“¶è¡Œ', color: '#006B3F', logo: 'CMBC' },
            'CITIC': { name: 'ä¸­ä¿¡é“¶è¡Œ', color: '#D4282D', logo: 'CITIC' },
            'CEB': { name: 'å…‰å¤§é“¶è¡Œ', color: '#6F2D91', logo: 'CEB' },
            'CIB': { name: 'å…´ä¸šé“¶è¡Œ', color: '#004EA2', logo: 'CIB' },
            'CGB': { name: 'å¹¿å‘é“¶è¡Œ', color: '#C8161D', logo: 'CGB' },
            'PAB': { name: 'å¹³å®‰é“¶è¡Œ', color: '#FF6600', logo: 'PAB' },
            'SPDB': { name: 'æµ¦å‘é“¶è¡Œ', color: '#0066B3', logo: 'SPDB' },
            'HXB': { name: 'åå¤é“¶è¡Œ', color: '#D32F2F', logo: 'HXB' }
        };

        // è·å–é“¶è¡Œè¯¦ç»†ä¿¡æ¯
        function getBankDetails(cardNumber) {
            const bin = cardNumber.substring(0, 6);
            const bank = bankDatabase[bin];
            
            if (bank) {
                return bank;
            }
            
            // å¦‚æœæ²¡æœ‰æ‰¾åˆ°åŒ¹é…çš„é“¶è¡Œï¼Œè¿”å›é»˜è®¤é“¶è¡Œ
            return { name: 'æœªçŸ¥é“¶è¡Œ', color: '#666666', logo: 'BANK' };
        }

        // ç»˜åˆ¶é“¶è¡Œå¡
        function drawBankCard(canvas, bank, cardNumber, cardHolder, isManualSelection = false) {
            const ctx = canvas.getContext('2d');
            
            // æ¸…ç©ºç”»å¸ƒ
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // ç»˜åˆ¶å¡ç‰‡èƒŒæ™¯ - æ¸å˜è‰²
            const gradient = ctx.createLinearGradient(0, 0, 800, 500);
            gradient.addColorStop(0, bank.color);
            gradient.addColorStop(1, adjustColor(bank.color, -40));
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, 800, 500);
            
            // æ·»åŠ è£…é¥°åœ†åœˆ
            ctx.fillStyle = 'rgba(255, 255, 255, 0.1)';
            ctx.beginPath();
            ctx.arc(650, 100, 150, 0, Math.PI * 2);
            ctx.fill();
            
            ctx.beginPath();
            ctx.arc(150, 400, 100, 0, Math.PI * 2);
            ctx.fill();
            
            // ç»˜åˆ¶é“¶è¡Œåç§°
            ctx.fillStyle = '#FFFFFF';
            ctx.font = 'bold 48px Arial';
            ctx.fillText(bank.name, 60, 100);
            
            // ç»˜åˆ¶é“¶è¡ŒLOGOæ–‡å­—
            ctx.font = 'bold 36px Arial';
            ctx.fillStyle = 'rgba(255, 255, 255, 0.8)';
            ctx.fillText(bank.logo, 650, 80);
            
            // ç»˜åˆ¶èŠ¯ç‰‡å›¾æ ‡
            ctx.fillStyle = '#FFD700';
            ctx.fillRect(60, 160, 100, 80);
            ctx.strokeStyle = '#FFF';
            ctx.lineWidth = 3;
            ctx.strokeRect(60, 160, 100, 80);
            
            // ç»˜åˆ¶èŠ¯ç‰‡å†…éƒ¨çº¿æ¡
            ctx.strokeStyle = '#DAA520';
            ctx.lineWidth = 2;
            for (let i = 0; i < 3; i++) {
                ctx.beginPath();
                ctx.moveTo(80 + i * 20, 170);
                ctx.lineTo(80 + i * 20, 230);
                ctx.stroke();
            }
            
            // ç»˜åˆ¶å¡å·
            ctx.font = '44px Courier New';
            ctx.fillStyle = '#FFFFFF';
            const formattedNumber = formatCardNumber(cardNumber);
            ctx.fillText(formattedNumber, 60, 320);
            
            // ç»˜åˆ¶æŒå¡äººä¿¡æ¯
            ctx.font = '24px Arial';
            ctx.fillStyle = 'rgba(255, 255, 255, 0.8)';
            ctx.fillText('CARD HOLDER', 60, 380);
            
            ctx.font = 'bold 32px Arial';
            ctx.fillStyle = '#FFFFFF';
            ctx.fillText(cardHolder.toUpperCase(), 60, 420);
            
            // ç»˜åˆ¶æœ‰æ•ˆæœŸ
            ctx.font = '24px Arial';
            ctx.fillStyle = 'rgba(255, 255, 255, 0.8)';
            ctx.fillText('VALID THRU', 550, 380);
            
            ctx.font = 'bold 32px Arial';
            ctx.fillStyle = '#FFFFFF';
            const expiry = generateExpiry();
            ctx.fillText(expiry, 550, 420);
            
            // æ·»åŠ æ‰‹åŠ¨é€‰æ‹©æ ‡è¯†ï¼ˆå¦‚æœæ˜¯æ‰‹åŠ¨é€‰æ‹©çš„ï¼‰
            if (isManualSelection) {
                ctx.font = '20px Arial';
                ctx.fillStyle = 'rgba(255, 255, 255, 0.6)';
                ctx.fillText('æ‰‹åŠ¨æŒ‡å®š', 680, 460);
            }
        }

        // ç”Ÿæˆæœ‰æ•ˆæœŸ
        function generateExpiry() {
            const now = new Date();
            const year = now.getFullYear() + 5;
            const month = String(now.getMonth() + 1).padStart(2, '0');
            return `${month}/${year.toString().slice(-2)}`;
        }

        // è°ƒæ•´é¢œè‰²äº®åº¦
        function adjustColor(color, amount) {
            const num = parseInt(color.replace('#', ''), 16);
            const r = Math.max(0, Math.min(255, (num >> 16) + amount));
            const g = Math.max(0, Math.min(255, ((num >> 8) & 0x00FF) + amount));
            const b = Math.max(0, Math.min(255, (num & 0x0000FF) + amount));
            return '#' + ((r << 16) | (g << 8) | b).toString(16).padStart(6, '0');
        }

        // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
        window.onload = function() {
            updatePrefix();
        };
    </script>
</body>
</html>